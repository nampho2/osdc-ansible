---
#- name: create nova key-pair
#  nova_keypair: state=present name=ansible_key login_username={{ lookup('env', 'OS_USERNAME') }} login_password={{ lookup('env', 'OS_PASSWORD') }} login_tenant_name={{ lookup('env', 'OS_TENANT_NAME') }} public_key='/glusterfs/users/npho/.ssh/id_rsa.pub'

- name: create login vm
  nova_compute:
    name: "{{ item }}"

    flavor_id: "{{ os_flavor }}"
    image_name: "{{ os_image }}"
    key_name: "{{ os_key }}"
    state: present

    auth_url: "{{ lookup('env', 'OS_AUTH_URL') }}"
    login_username: "{{ lookup('env', 'OS_USERNAME') }}"
    login_password: "{{ lookup('env', 'OS_PASSWORD') }}"
    login_tenant_name: "{{ lookup('env', 'OS_TENANT_NAME') }}"
  with_items: groups.cluster

